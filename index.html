<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Маркет Тревеллер — заявка</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{--pad:16px}
    body{margin:0;background:var(--tg-theme-bg-color);color:var(--tg-theme-text-color);
         font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{padding:var(--pad);max-width:640px;margin:0 auto}
    label{display:block;margin:12px 0 6px;opacity:.85}
    input,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid var(--tg-theme-hint-color);
                   background:var(--tg-theme-secondary-bg-color);color:var(--tg-theme-text-color)}
    textarea{min-height:96px;resize:vertical}
    .hint{opacity:.7;font-size:13px;margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Заявка на подбор тура</h2>
    <p id="who" class="hint">Загружаю…</p>

    <label>Имя*</label>
    <input id="name" placeholder="Как к вам обращаться"/>

    <label>Телефон/Telegram*</label>
    <input id="contact" placeholder="@username или номер"/>

    <label>Комментарий</label>
    <textarea id="comment" placeholder="Куда, когда, бюджет и пожелания"></textarea>

    <p class="hint">Нажмите «Отправить» внизу.</p>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    // tg.expand(); // если на Desktop крашится — оставь закомментированным

    // Покажем имя
    const u = tg.initDataUnsafe?.user;
    document.getElementById('who').textContent = u
      ? `Вы: ${u.first_name} ${u.last_name||''} (@${u.username||'—'})`.trim()
      : 'Открыто вне Telegram';

    const name = document.getElementById('name');
    const contact = document.getElementById('contact');
    const comment = document.getElementById('comment');

    // Главная кнопка Telegram
    tg.MainButton.setText('Отправить заявку');
    tg.MainButton.disable();

    function validate(){
      if(name.value.trim().length>=2 && contact.value.trim().length>=3){
        tg.MainButton.enable();
      } else {
        tg.MainButton.disable();
      }
    }
    [name,contact,comment].forEach(i=>i.addEventListener('input', validate));
    validate();

    // Отправка данных боту
    tg.MainButton.onClick(() => {
      const payload = {
        event: 'lead',
        name: name.value.trim(),
        contact: contact.value.trim(),
        comment: comment.value.trim(),
        ts: Date.now()
      };
      tg.sendData(JSON.stringify(payload));
      try {
        tg.showPopup({title:'Готово', message:'Заявка отправлена боту ✅'});
      } catch(_) {}
    });
  </script>
</body>
</html>
